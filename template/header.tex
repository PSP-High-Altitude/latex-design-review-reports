\usepackage{amsmath, amssymb, amsthm}
\usepackage[title,titletoc]{appendix}
\usepackage[letterpaper, margin=1.1in]{geometry}
\usepackage{booktabs}
\usepackage[backend=biber]{biblatex}
\usepackage{caption}
\usepackage[shortlabels]{enumitem}
\usepackage[shortcuts]{extdash}
\usepackage{fancyhdr}
\usepackage{fontspec}
\usepackage{graphicx}
\usepackage{hyperref}
\usepackage[nameinlink]{cleveref}  % must be loaded after hyperref
\usepackage{longtable}
\usepackage{multicol, multirow}
\usepackage{pgfplots}
\usepackage{ragged2e}
\usepackage{setspace}
\usepackage{siunitx}
\usepackage{tabularray}
\usepackage{tabularx, tabulary}
\usepackage{tikz}
\usepackage{titlesec}
\usepackage{xcolor}
\usepackage{xparse}

\definecolor{night-sky}{RGB}{37,37,38}
\definecolor{rush}{RGB}{218,170,0}
\definecolor{moondust}{RGB}{242,239,233}

\definecolor{boilermaker-gold}{RGB}{207,185,145}
\definecolor{aged}{RGB}{142,111,62}
\definecolor{field}{RGB}{221,185,69}
\definecolor{dust}{RGB}{235,217,159}
\definecolor{steel}{RGB}{85,89,96}
\definecolor{cool-gray}{RGB}{111,114,123}
\definecolor{railway-gray}{RGB}{157,151,149}
\definecolor{steam}{RGB}{196,191,192}

\setmainfont{Libre Franklin}
\setlength{\parskip}{1.5ex}
\setlength{\parindent}{0.7cm}
\addtolength{\skip\footins}{1.5ex}
\titlespacing\section{0pt}{5pt}{0pt}
\titlespacing\subsection{0pt}{4pt}{0pt}
\titlespacing\subsubsection{0pt}{2pt}{0pt}
\AddToHook{cmd/section/before}{\clearpage}
\renewcommand{\arraystretch}{1.45}

\crefformat{footnote}{#2\footnotemark[#1]#3}

% TODO: fix this
%\setlength{\headheight}{32.50275pt}
%\addtolength{\topmargin}{-20.50275pt}

\newlength{\offset}
\newcommand{\raisetarget}[1]{\raisebox{\offset}[0pt][0pt]{\hypertarget{#1}{}}}

\setlist{nosep}

\newfontfamily\titlefont[SizeFeatures={Size=36}]{Saira}
\newfontfamily\titlefontmedium[SizeFeatures={Size=22}]{Saira}
\newfontfamily\titlefontsmall[SizeFeatures={Size=14}]{Saira}
\newcommand{\totitlefont}{\fontsize{36pt}{40pt}\selectfont\titlefont}
\newcommand{\totitlefontmedium}{\fontsize{22pt}{26pt}\selectfont\titlefontmedium}
\newcommand{\totitlefontsmall}{\fontsize{14pt}{16pt}\selectfont\titlefontsmall}

\pgfplotsset{compat=1.18}

\addtolength{\headsep}{1ex}
\renewcommand{\headruleskip}{-1.5ex}
\renewcommand{\headrule}{{\color{rush}\rule{\textwidth}{1pt}}}
\renewcommand{\footrule}{{\color{rush}\rule{\textwidth}{1pt}}}
\renewcommand{\sectionmark}[1]{\markright{#1}}
\renewcommand{\subsectionmark}[1]{}

%\addtolength{\abovecaptionskip}{-0.4cm}

%\renewcommand{\contentsname}{Contents\raisetarget{toc}}

\fancypagestyle{toc}{%
    \fancyhf{}%
    \fancyhead[R]{\includegraphics[height=1cm]{\logo}}%
    \fancyfoot[C]{\textbf{\thepage}}%
}

\fancypagestyle{regular}{%
    \fancyhf{}%
    \fancyhead[L]{\textit{\rightmark}}%{\includegraphics[height=1cm]{\logo}}
    \fancyhead[R]{\hyperlink{toc}{\includegraphics[height=1cm]{\logo}}} %
    \fancyfoot[C]{\textbf{\thepage}}%
}

\hypersetup{
    colorlinks,
    linkcolor={black},
    citecolor={black},
    urlcolor={blue!70!black}
}

\NewDocumentCommand{\makebasictitlepage}{ O{} m o }{
    \thispagestyle{empty}
    ~ \vspace{2.5cm}

    \begin{center}
        \includegraphics[width=9cm]{\logo}
    \end{center}
    \vfill

    \setstretch{2.5}

    \noindent {\totitlefont \color{aged} PSP #1}

    \noindent {\totitlefontmedium #2}

    \IfNoValueF{#3}{
        \vspace{-2.5ex}
        \noindent {\totitlefontsmall \color{cool-gray} #3}
    }

    \setstretch{1}

    \vspace{1cm}
    \newpage
}

\newenvironment{reqtable}[1]{
    \begin{center}
    \footnotesize
    \setlength{\offset}{\baselineskip}
    \begin{longtable}{#1}
}{
    \end{longtable}
    \end{center}
}

\newenvironment{reqtable-stakeholder}{
    \begin{reqtable}{p{1cm} >{\raggedright\arraybackslash}p{4.5cm} >{\raggedright\arraybackslash}p{9.5cm} >{\raggedright\arraybackslash}p{1.75cm}}
}{
    \end{reqtable}
}

\newenvironment{reqtable-func}{
    \begin{reqtable}{p{1.5cm} >{\raggedright\arraybackslash}p{4.5cm} >{\raggedright\arraybackslash}p{7cm} >{\raggedright\arraybackslash}p{1.75cm}}
}{
    \end{reqtable}
}

\newenvironment{reqtable-system}{
    \begin{reqtable}{p{1.5cm} >{\raggedright\arraybackslash}p{9cm} >{\raggedright\arraybackslash}p{1.75cm}}
}{
    \end{reqtable}
}

\newenvironment{reqtable-subsys}{
    \begin{reqtable}{p{1.5cm} >{\raggedright\arraybackslash}p{3.5cm} >{\raggedright\arraybackslash}p{8cm} >{\raggedright\arraybackslash}p{2.5cm}}
}{
    \end{reqtable}
}
